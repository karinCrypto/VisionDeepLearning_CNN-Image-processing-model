# 📘 Convolution & CNN Feature Extraction — Summary

## 1. Introduction
이 문서는 컴퓨터 비전의 핵심 개념인 **컨볼루션(Convolution)**,  
**커널(Kernel)**, **필터(Filter)**, **Sobel**, **CNN의 패턴 학습 방식**,  
그리고 **Fully Connected Layer의 가중치 구조**까지  
하나의 흐름으로 정리한 학습 문서입니다.

---

## 2. Convolution 기본 원리

### ✔ 컨볼루션 계산 방식
윈도우 영역의 픽셀값 × 커널의 값
→ 전부 곱하고
→ 다 더함(sum)


### ✔ 핵심 원리
**커널에 새겨져 있는 “패턴 모양”과 이미지 패치가 비슷하면 출력이 커진다.**

예시:  
- Sobel 필터는 엣지를 찾도록 설계  
- 엣지가 있으면 Sobel 출력값 ↑  
- 엣지가 없으면 Sobel 출력값 ↓

CNN도 이 원리를 그대로 활용한다.

---

## 3. Kernel vs Filter

### ✔ Kernel
- 3×3, 5×5 같은 숫자 행렬(mask)  
- 컨볼루션에서 *직접 곱해지는 값들의 집합*

### ✔ Filter
- 여러 커널을 포함할 수도 있는 더 큰 개념  
- 커널 적용 후 생성되는 feature map까지 포함하는 개념

요약:  
**커널은 작은 연산 단위, 필터는 전체적 개념**

---

## 4. CNN에서 커널은 어떻게 학습되는가?

### ✔ (1) 처음에는 랜덤 값  
[-0.12, 0.03, 0.27, ...] 이런 식으로 아무 의미 없는 숫자들로 시작.

### ✔ (2) Loss와 Backpropagation으로 값이 조정됨  
- 정답과 예측 차이(Loss)를 계산  
- Loss를 줄이는 방향으로 커널 값을 미세하게 조정  
- 반복되면서 “유용한 패턴”을 감지하는 형태로 변화

### ✔ (3) 학습 후 커널은 특정 패턴 탐지기로 변신  
- 어떤 커널은 엣지 탐지기  
- 어떤 커널은 질감(texture) 탐지기  
- 더 깊어지면 얼굴/사물의 더 복잡한 패턴까지 탐지

➡ **CNN 학습 = 커널(마스크)값을 데이터가 좋은 방향으로 자동 조정하는 과정**

---

## 5. 필터링 상식: Gaussian & Moving Average

### ✔ Gaussian Blur
- 노이즈 제거  
- 자연스러운 블러 (가우시안 가중치)

### ✔ Moving Average (평균 필터)
- 단순 블러  
- 모든 픽셀을 동일 비율로 평균  
- Gaussian보다 엣지 손상 심함  

전통적인 필터 이해는 CNN 이해에 매우 도움된다.

---

## 6. RGB vs Grayscale

- **Grayscale:** 1채널 (H × W)  
- **RGB:** 3채널 (H × W × 3)  
- CNN은 3채널 각각에 대해 가중치를 학습해 더 풍부한 정보를 얻는다.

---

## 7. Fully Connected Layer 구조  
입력이 400(=5×5×16)일 때 FC를 통과하는 구조는 다음과 같습니다.

---

### ✔ FC1: 400 → 120
W1 = (120 × 400) # 48,000개의 weight
b1 = (120)

---

### ✔ FC2: 120 → 84
W2 = (84 × 120) # 10,080개의 weight
b2 = (84)

---

### ✔ FC3: 84 → 10
W3 = (10 × 84) # 840개의 weight
b3 = (10)


➡ FC 레이어는 항상 **입력 × 출력** 구조의 가중치 행렬을 갖는다.  
➡ 즉, 입력이 400이라면 FC1의 weight shape은 (120 × 400)이 되는 것이 정확히 맞다.

---

## 8. CNN이 강력한 이유

### ✔ (1) 비선형성(Non-linearity)
ReLU를 통해 단순한 선형 조합을 넘어 더 복잡한 구조까지 표현 가능.

### ✔ (2) 계층 깊이에 따른 패턴 확장
- 초반 레이어: 작은 패턴(엣지, 질감)  
- 중간 레이어: 중간 패턴(모양, 구조)  
- 후반 레이어: 큰 패턴(물체 전체)

### ✔ (3) 사람이 만든 Sobel보다 훨씬 복잡한 필터 자동 생성
CNN은 사람이 직접 설계한 필터보다  
데이터 기반으로 훨씬 강력한 패턴을 자동 학습한다.

---

## 9. 참고 링크
- https://www.youtube.com/watch?v=LprOT6xpw2E  
- https://trts1004.tistory.com/12109067  

---

## 10. Summary
- 컨볼루션은 커널과 이미지 패턴이 비슷하면 큰 값을 출력  
- CNN은 이 원리를 기반으로 커널을 자동 학습  
- Gaussian/Moving Average 같은 전통 필터는 기본 개념 이해에 도움  
- FC는 입력×출력 차수만큼 weight matrix 구성  
- CNN은 작은 패턴부터 큰 패턴까지 단계적으로 인식하는 구조

